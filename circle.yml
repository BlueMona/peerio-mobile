machine:
  pre:
    - pip install --user --ignore-installed --upgrade --verbose virtualenv
  environment:
    XCODE_SCHEME: peeriomobile
    PATH: '$PATH:$HOME/node/node-v8.4.0-darwin-x64/bin'
    PEERIO_IOS_SIM: 'iPhone 6 Plus'
    PEERIO_IOS_VERSION: '10.3'
    PEERIO_TEST_PLATFORM: 'ios'
  xcode:
    version: 8.3

dependencies:
  pre:
    - "ls \"$HOME/node/node-v8.4.0-darwin-x64\" || mkdir \"$HOME/node\""
    - "ls \"$HOME/node/node-v8.4.0-darwin-x64\" || curl -L \"https://nodejs.org/dist/v8.4.0/node-v8.4.0-darwin-x64.tar.gz\" -o \"$HOME/node/node-v8.4.0-darwin-x64.tar.gz\""
    - "ls \"$HOME/node/node-v8.4.0-darwin-x64\" || tar -xzf \"$HOME/node/node-v8.4.0-darwin-x64.tar.gz\" -C \"$HOME/node/\""
    - "rm -f \"$HOME/node/node-v8.4.0-darwin-x64.tar.gz\""
    - ls "$HOME/node/node-v8.4.0-darwin-x64"
    - echo $PATH
    - pwd
    - npm install
    - bash scripts/setup_tests.sh

compile:
  override:
    - npm update && npm install
    - ./node_modules/.bin/react-native run-ios
    
test:
  override:
    - mkdir -p $CIRCLE_TEST_REPORTS/py.test
    - npm test
